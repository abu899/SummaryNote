# 도메인 모델 시작하기

## 도메인이란?

`소프트웨어로 해결하고자 하는 문제 영역`이 도메인이며, 한 도메인은 다시 하위 도메인으로 나눌 수 있다.

하지만, 특정 도메인을 위한 소프트웨어라고 해서 도메인이 제공해야하는 모든 기능을 직접 구현해야하는 것은 아니다.
예를 들어, 쇼핑몰 내 배송 시스템과 관련된 기능을 제공할 때, 직접 배송 시스템을 구축하는 것이 아닌,
외부 시스템을 사용하고 `정보를 제공하는데 필요한 기능만 일부 연동`할 수 있다.

## 도메인 모델

기본적으로 도메인 모델은 특정 도메인을 개념적으로 표현한 것이다.
[그림 1.3]은 객체를 이용한 도메인 모델로, 도메인을 이해하려면 도메인이 제공하는 기능과
도메인의 주요 데이터 구성을 파악해야한다.
이때, 기능과 데이터를 함께 보여주는 객체 모델은 도메인을 모델링하기에 적합하다.

도메인은 기본적으로 도메인 자체를 이해하기 위한 `개념 모델`이다.
즉, 구현 기술에 맞는 `구현 모델이 따로 필요`하다.

## 도메인 모델 패턴

일반 적인 어플리케이션의 아키텍쳐 구성

- Presentation(사용자 인터페이스 또는 표현 계층)
  - 사용자의 요청을 처리하고 사용자에게 정보를 보여줌
  - 사용자는 실제 사람일 수도 있고 외부 시스템일 수 있음
- Application(응용 계층)
  - 사용자가 요청한 기능을 실행
  - 업무 로직을 직접 구현하지 않으며, `도메인 계층을 조합하여 기능을 실행`
- Domain(도메인 계층)
  - 시스템이 제공할 도메인 규칙을 구현
- Infrastructure(인프라스트럭처 계층)
  - 데이터베이스나 메시징 시스템과 같은 외부 시스템과의 연동을 처리

도메인 계층은 도메인의 핵심 규칙을 구현한다.
여기서 중요한 점은 `도메인과 관련된 중요 업무 규칙은 도메인 내에서 구현`한다는 점이다.
핵심 규칙을 구현한 코드는 도메인 모델에만 위치하기에 규칙이 바뀌거나 규칙을 확장할 때도,
`다른 코드에 영향을 덜 주고 변경 내역을 반영`할 수 있다.

## 도메인 모델 도출

도메인을 모델링할 때 기본이 되는 작업은 구성하는 핵심 구성요소, 규칙, 기능을 찾는 것으로 `요구사항에서 출발`한다.

요구 사항은 도메인이 어떤 데이터로 구성되는지 알려준다.
- 한 `상품`을 한 개 이상 주문할 수 있다.
- 각 상품의 `구매 가격` 합은 `상품 가격`에 `구매 갯수`를 곱한 값이다.

요구사항은 도메인간의 관계를 알려준다.
- 최소 한 종류 이상의 상품을 주문해야 한다.
- 총 주문 금액은 각 상품의 구매 가격 합을 모두 더한 금액이다.

도메인 구현 시, 특정 조건이나 상태에 따라 제약이나 규칙이 달리 적용되는 경우가 다수 존재한다.
- 출고를 하면 배송지를 변경할 수 없다
- 출고 전에 주문을 취소할 수 있다.

또한, 요구사항은 도메인이 가져야하는 상태에 대해서도 알려준다.
- 고객이 `결제를 완료하기 전`에는 상품을 준비하지 않는다

## 엔티티와 밸류

### Entity

엔티티의 가장 큰 특징은 `식별자`를 가진다는 것이다. 즉, 엔티티마다 `고유`하고 서로 다른 식별자를 가진다.
엔티티의 `식별자는 불변`이며 두 엔티티 객체의 식별자가 같으면 두 엔티티는 같다고 판단한다.

식별자를 생성하는 시점은 도메인의 특징과 사용 기술에 따라 달라진다.

- 특정 규칙에 따라 생성
  - 특정 규칙 중 시간과 다른 값을 조합하는 경우 동시에 식별자를 생성해도 같은 식별자가 만들어지지 않게 주의해야한다.
- UUID나 Nano ID와 같은 고유 식별자 생성기 사용
- 값을 직접 사용
  - 아이디나 이메일등은 사용자가 직접 입력하기에 중복되지 않게 사전에 방지해야한다.
- 일련번호 사용(시퀀스나 DB의 자동 증가)

DB 시퀀스를 이용한 방법을 제외하고는 식별자를 먼저 만들고 엔티티 객체를 생성할 때 식별자를 전달한다.

### Value

밸류 타입은 개념적으로 완전한 하나를 표현할 때 사용한다.
예를 들어 배송 받을 사람의 이름과 전화번호가 있는 경우, 이를 완전한 하나로 표현하기 위해
`Receiver`라는 클래스를 만들어 도메인 개념으로 표현할 수 있다.

또한 밸류타입은 밸류 타입을 위한 기능을 추가할 수 있다.
예를 들어, Money 라는 도메인에서 돈과 관련한 계산에 대한 로직을 도메인에 추가 가능하다.

밸류 객체의 `데이터를 변경하는 경우` 기존 데이터를 변경하는 것이 아닌 `새로운 밸류 객체를 생성`하는 방식을 선호한다.
데이터 변경 기능을 제공하지 않는 타입을 `불변(immutable)`이라고 하며 안전한 코드를 작성할 수 있게해준다.
불변 객체를 통해 `참조 투명성과 Thread-safe` 할 수 있다.

엔티티의 식별자의 실제 데이터는 String 형태인 경우가 많은데 이를 밸류 타입을 통해
단순 문자열이 아닌 특별한 의미를 지니게 할 수 있다.

## 도메인 용어와 유비쿼터스 언어

도메인에서 사용하는 용어는 매우 중요하다.
에릭 에반스는 도메인 주도 설계에서 언어의 중요함을 강조하기 위해 `유비쿼터스 언어`라는 용어를 사용했다.
프로젝트 내 모든 사람이 공통의 언어를 만들고 대화, 문서, 도메인 모델, 코드, 테스트 등 `모든 곳에서 같은 용어를 사용`한다.
용어의 모호함을 줄일 수 있고 개발자는 도메인과 코드 사이에서 불필요한 해석 과정을 줄일 수 있다.