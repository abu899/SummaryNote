# 표현 영역과 응용 영역

응용 영역과 표현 영역이 사용자와 도메인을 연결해 주는 매개체 역할을 한다.
실제 사용자가 원하는 기능을 제공하는 것은 응용 영역에 위치하는 서비스이다.

응용 서비스의 주요 역할은 도메인 객체를 사용해서 사용자의 요청을 처리하는 것이므로,
응용 서비스는 주로 도메인 객체 간의 흐름을 제어한다.

응용 서비스가 도메인 로직 일부를 구현하면 코드 중복, 로직 분산 등 코드 품질에 안좋을 수 있다.
- 코드의 응집성이 떨어짐
- 여러 응용 서비스에서 동일한 도메인 로직을 구현할 가능성이 높아짐

## 응용 서비스의 구현

응용 서비스는 디자인 패턴의 파사드와 같은 역할을 한다.

응용 서비스의 크기는 두 가지 방식으로 구현할 수 있다.

- 한 응용 서비스 클래스에 모든 기능 구현하기
  - 각 기능에서 동일 로직에 대한 코드 중복 제거 가능
  - 클래스의 크기가 커짐
  - 연관성이 적은 코드가 한 클래스에 함께 위치할 가능성이 높음
- 구분되는 기능별로 응용 서비스 클래스 따로 구현하기
  - 클래스의 크기가 작아짐
  - 연관된 기능의 코드만 한 클래스에 위치함
  - 클래스 파일의 갯수가 늘어남

### 응용 서비스의 인터페이스와 클래스

인터페이스가 필요할까?

인터페이스가 명확하게 필요하기 전까지는 응용 서비스에 대한 인터페이스를 작성하는 것이 좋다고 볼 수 만은 없다.
테스트 또한 mockito를 이용해 구현할 수 있기 때문에 이에 대한 고민이 필요하다

### 표현 영역에 의존하지 않기

응용 서비스에서 표현 영역에 대한 의존이 발생하면 응용 서비스만 단독으로 테스트하기 어려워진다.
또한, 응용 서비스가 표현 영역의 역할을 대신하는 상황이 벌어질 수도 있다.
응용 서비스가 표현 영역의 기술을 사용하지 않도록 해야한다.

## 표현 영역

표현 영역은 크게 세가지 일을 담당한다

- 사용자가 시스템을 사용할 수 있는 흐름을 제공하고 제어한다
- 사용자의 요청을 알맞은 응용 서비스에 전달하고 결과를 사용자에게 제공한다
- 세션을 관리하고 권한 검사를 실행한다

## 값 검증

값 검증은 표현 영역과 응용 서비스 두 곳에서 모두 수행 가능하다.

- 표현 영역
  - 필수 값, 값의 형식, 범위 검증
- 응용 서비스
  - 데이터의 존재 유무와 같은 논리적 오류 검증

하지만 응용 서비스에서 필요한 값 검증을 모두 처리할 수도 있다.
이렇게되면 코드가 늘어나는 단점이 존재하지만 응용 서비스의 완성도가 높아진다는 장점을 가진다.

## 권한 검사

권한 검사는 표현 영역, 응용 서비스, 도메인에서 수행 가능하다.

표현 영역에서는 인증된 사용자인지 아닌지 검사하는 것이 기본적이며 URL을 인증된
사용자만 접근하게 하는 것이 대표적이다. 이러한 접근 제어는 서블릿 필터에 위치하는게 용이하다.

URL 만으로 접근제어를 할 수없는 경우 응용 서비스의 메서드 단위로 권한 검사를 수행할 수 있다.

개별 도메인 객체 단위로 권한 검사를 하는 경우 구현이 복잡해지는데, 필요한 애그리거트를 먼저 로딩해야 하기 때문이다.

## 조회 전용 기능과 응용 서비스

단일 쿼리만 실행하는 조회 전용 기능에도 응용서비스가 필요할까?

이런 경우 트랜잭션이 필요하지도 않기 때문에 서비스를 만들 필요없이 표현 영역에서
바로 조회 전용 기능을 사용해도 문제가 없을 수 있다.
자세한 내용은 11장 정리에서 살펴보자