# 아키텍쳐 개요

## 네 개의 영역

- 표현 영역은 사용자의 요청을 받아 응용 영역에 전달하고, 응용 영역의 처리 결과를 다시 사용자에게 보여준다.
- 응용 영역은 시스템이 사용자에게 제공할 기능을 구현한다고 볼 수 있다.
- 응용 서비스는 로직을 직접 수행하기 보다는 `도메인 모델에 로직 수행을 위임`한다.
- 인프라스트럭쳐 영역은 구현 기술에 대한 것으로 논리적인 개념을표현하기 보다는 실제 구현을 다룬다.

## 계층 구조 아키텍쳐

네 영역을 구성할 때 많이 사용하는 아키텍쳐가 [그림 2.4]와 같은 계층 구조 아키텍쳐이다.
계층 구조는 `상위 계층에서 하위 계층으로의 의존`만하고, 반대는 의존하지 않는다.

이 구조의 단점은 표현, 응용, 도메인 계층이 상세한 구현 기술을 다루는 `인프라스트럭쳐 계층에 종속`된다는 점이다.
이렇게 되면 실제 구현을 하지 않는한 테스트가 어렵고 구현 방식을 변경하기 어려워진다.

## DIP

고수준 모듈은 의미 있는 단일 기능을 제공하는 모듈로 기능을 구현하기 위해선 여러 하위 기능이 필요하다.
저수준 모듈은 이런 하위 기능을 실제로 구현한 것이다.
그렇기에 고수준 모듈이 제대로 동작하기 위해선 저수준 모듈을 사용해야하는데, 계층 구조에서
`고수준 모듈이 저수준 모듈에 의존`하면 `구현 변경과 테스트가 어렵다`는 문제가 생긴다.

의존 관계 역전(DIP)은 이 문제를 `추상화된 인터페이스`를 통해 해결하여 저수준 모듈이 고수준 모듈에 의존하도록 바꿔준다.
원래는 저수준 모듈을 사용하기 위해선 고수준 모듈이 의존해야하지만, DIP를 통해 저수준 모듈이
고수준 모듈에 의존하기 때문에 의존 관계 역전이라고 한다.

### DIP 주의 사항

DIP를 잘못 생각하면 `단순 인터페이스와 구현 클래스의 분리`정도로 받아들일 수 있다.
[그림 2.10]처럼 단순 저수준 모듈의 인터페이스를 추출하는 경우가 그러하다.
DIP의 핵심은 `고수준 모듈이 저수준 모듈에 의존하지 않도록 하는 것`이다.

### DIP와 계층구조

계층 구조에서 인프라스트럭쳐 계층이 가장 하단에 위치하지만 DIP를 적용하게 되면 
인프라스트럭쳐 영역은 응용 영역과 도메인 영역에 의존하는 구조로 바뀐다.

## 도메인 영역의 주요 구성요소

도메인 영역을 구성하는 요소를 간단히 살펴보면 다음과 같다.

- 엔티티
  - 고유 식별자를 갖는 객체로 자신의 라이프 사이클을 갖는다
  - 도메인의 고유한 개념을 표현하며, 도메인 모델의 데이터와 데이터와 관련된 기능을 제공한다.
- 밸류
  - 고유 식별자를 갖지 않는 객체로 개념적인 하나의 값을 표현한다.
  - 엔티티의 속성이나 다른 벨류 타입의 속성으로도 사용 가능하다.
- 애그리거트
  - 연관된 엔티티와 밸류 객체를 개념적으로 하나로 묶은 것이다.
- 리포지터리
  - 도메인 모델의 영속성을 처리한다.
- 도메인 서비스
  - 특정 엔티티에 속하지 않는 도메인 로직을 제공한다.
  - 도메인 로직이 여러 엔티티와 밸류를 필요로 하면 도메인 서비스에서 로직을 구현한다

### 엔티티와 밸류

도메인 모델의 엔티티와 DB 모델의 엔티티를 거의 같은 것으로 생각할 수 있다.
하지만 도메인 모델의 `엔티티는 데이터와 함께 도메인 기능을 제공`한다는 차이점이 존재한다.
또한, 도메인 모델의 엔티티는 `두 개 이상의 데이터가 개념적으로 하나인 밸류 타입을 이용`해 표현 가능하다.

### 애그리거트

도메인이 커질수록 개발할 도메인 모델도 커지고 복잡해지며 많은 엔티티와 밸류가 등장한다.
이렇게 되면 큰 수준에서 모델을 이해하지 못하면 모델을 관리할 수 없는 상황이 발생한다.
전체 구조를 이해하는데 도움을 주는 것이 애그리거트로, 관련 객체를 하나로 묶은 군집이다.

애그리거트는 군집에 속한 객체를 관리하는 루트 엔티티를 갖는다.
루트 엔티티는 엔티티와 밸류를 이용해서 애그리거트가 구현해야할 기능을 제공한다.
또한, 애그리거트 루트를 통해 간접적으로 애그리거트 내 다른 엔티티나 밸류 객체에 접근할 수 있다.

### 리포지터리

리포지터리는 애그리거트 단위로 도메인 객체를 저장하고 조회하는 기능을 정의한다.
도메인 관점에서 도메인 객체를 영속화하는데 필요한 기능을 추상화한 고수준 모듈에 속하고,
이를 구현하는 것은 저수준모듈로 인프라스트럭쳐 영역에 속한다.

## 인프라스트럭쳐 개요

인프라스트럭쳐 영역은 표현, 응용, 도메인 영역을 지원한다.
이를 직접 사용하기보다는 인터페이스를 인프라스트럭쳐 영역에서 구현하는 것이 시스템을 더 유연하고
테스트하기 쉽게 만들어준다.