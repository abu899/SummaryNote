# CQRS

## 단일 모델의 단점

조회의 경우 속도가 빠를수록 좋지만, 여러 애그리거트의 데이터가 필요한 경우 구현방법을 고민해야한다.
연관에 따라 즉시 로딩이나 지연 로딩으로 처리해야하는 고민도 생긴다. 이런 고민이 생기는 이유는
조회와 상태 변경에 모두 단일 도메인 모델을 사용하기 때문이다.

상태 변경을 위한 모델과 조회를 위한 모델을 분리한다면 복잡도를 낮출 수 있다.

## CQRS

시스템이 제공하는 기능은 크게 `상태를 변경`하는 기능과 `조회`하는 기능으로 나눌 수 있다.
이 두 기능을 분리하는 것을 CQRS(Command Query Responsibility Segregation)라고 한다.
CQRS을 이용하면 단일 모델을 사용할 때 발생하는 복잡도를 해결할 수 있다.

CQRS를 사용하면 각 모델에 맞는 구현 기술을 선택 가능하다.
상태 변경에 있어서는 객체 지향에 기반하여 도메인 모델을 구현하기에 좋은 JPA를 사용할 수 있고,
조회에는 DB 테이블에서 SQL로 데이터를 조회하기 좋은 마이바티스를 사용할 수도 있다.

CQRS에서 명령 모델은 상태를 변경하는 도메인로직에 초점을 맞추고 쿼리 모델은
데이터를 조회하는데 초점을 맞춰 설계한다.
서로 다른 데이터 저장소를 사용할 수 도 있다. 명령 모델은 트랜잭션을 지원하는 RDBMS를
사용하고 쿼리 모델은 조회 성능이 좋은 메모리 기반 NoSQL을 사용할 수도 있다.

## 웹과 CQRS

메모리에 캐싱하는 데이터는 DB에 보관된 데이터를 그대로 저장하기 보다는 화면에 맞는 모양으로
변환된 데이터를 캐싱할 때 성능에 더 유리하다. 즉, 조회 전용 모델을 캐시하는 것이다.

## CQRS의 장단점

- 장점
  - 명령 모델을 구현할 때 도메인 자체에 집중 가능
  - 조회 성능을 향상시키는데 유리
    - 조회 단위로 캐시 적용 가능
    - 조회 전용 저장소를 통해 조회 처리량 향상
- 단점
  - 구현해야할 코드가 많음
    - 구현비용과 조회 전용 모델을 만들 때 발생하는 구현 비용을 고려해야함
  - 더 많은 구현 기술 필요
    - ex) 데이터 동기화를 위한 메시징 시스템