# 도메인 모델과 바운디드 컨텍스트

## 도메인 모델과 경계

처음 도메인 모델을 만들 때 완벽하게 표현하는 단일 모델을 만드는 시도를 할 수 있다.
하지만, 한 개의 모델로 여러 하위 도메인을 모두 표현하려고 하면, 하위 도메인에 맞지 않는 모델을 만들게 된다.

논리적으로 같은 존재처럼 보이지만 하위 도메인에 따라 다른 용어를 사용하기 때문이다.
예를 들어, 시스템 사용자를 회원 도메인에서는 회원, 주문 도메인에서는 주문자, 배송 도메인에서는
보내는 사람이라고 부를 수 있다.

그렇기에 한 개의 모델로 모든 하위 도메인을 표현하려는 시도는 올바른 방법이 아니고 그럴 수도 없다.
올바른 도메인 모델 개발을 위해서는 `하위 도메인 마다 모델`을 만들어야 한다.
명시적으로 구분되는 경계를 가지게하여, 각 하위 도메인별로 `다르게 발전하는 요구사항`을
모델에 반영하기 쉬워진다.

모델은 특정한 컨텍스트하에 완전한 의미를 갖는다.
이런 구분되는 경계를 갖는 컨텍스트를 바운디드 컨텍스트(Bounded Context)라고 부른다.

## 바운디드 컨텍스트

한 개의 바운디드 컨텍스트는 논리적으로 한 개의 모델을 가지며, 용어를 기준으로 구분한다.
이런 바운디드 컨텍스트는 사용자에게 `기능을 제공하는 물리적 시스템`으로, 도메인 모델은 바운디드
컨텍스트 안에서 `도메인을 구현`한다.

여러 하위 도메인을 하나의 바운디드 컨텍스트에서 개발할 때 `하위 도메인의 모델이 섞이지 않도록 주의`해야한다.
한 개의 바운디드 컨텍스트가 여러 하위 도메인을 포함하더라도 하위 도메인마다 `구분되는 패키지`를 통해
`구분되는 경계를 갖게`하여 하위 도메인마다 바운디드 컨텍스트를 갖는 효과를 낼 수 있다.
바운디드 컨텍스트는 도메인 모델을 구분하는 경계가 되기 때문에 바운디드 컨텍스트는 구현하는 하위 도메인에 알맞은 모델을 포함한다.

바운디드 컨텍스트는 도메인 기능을 사용자에게 제공하는데 필요한 표현, 응용 서비스, 인프라스트럭쳐 영역 모두를
포함한다.

## 바운디드 컨텍스트 간 통합

개발을 하다 보면 바운디드 컨텍스트 간 통합이 발생하는 상황이 발생할 수 있다.

이 때, 바운디드 컨텍스트 간 REST API를 호출하는 것은 두 바운디드 컨텍스트를 직접 통합하는 방법이다.
`서로 다른 모델을 기반`으로 하기 때문에 도메인 모델이 일치하지 않는 데이터를 제공하게 된다.
그렇기에 적합한 모델로 변환하거나 변환과정이 복잡하다면 별도의 클래스를 통해 변환을 처리해야한다.

간접 통합 방식으로는 대표적으로 메시지 큐를 사용하는 방법이 존재한다.
메시지 큐를 이용한다는건 `두 바운디드 컨텍스트가 사용할 메시지의 데이터 구조를 맞춰야함`을 의미한다.
어떤 도메인 관점에서 모델을 사용하냐에 따라 두 바운디드 컨텍스트의 구현 코드가 달라지게 된다.

## 바운디드 컨텍스트 간 관계

바운디드 컨텍스트는 어떤 식으로든 연결되기 때문에 두 바운디드 컨텍스트는 다양한 방식으로 관계를 맺는다.
앞서 언급한 간단한 방법은 REST API를 호출하는 것이다.

이 경우 API를 호출하는 쪽은 API를 제공하는 쪽에 의존하게 된다.
하위(downstream) 컴포넌트는 `상위(upstream) 컴포넌트가 제공하는 데이터와 기능에 의존`하게 되는 것이다.
상위 컴포넌트는 서비스 공급자 역할을 하고 하위 컴포넌트는 서비스를 이용하는 고객이 된다.

여러 하위 컴포넌트 사용자가 존재하는 경우 여러 요구사항을 수용하는 API를 만들고` 서비스 형태로 공개`해서 서비스의 일관성을 유지할 수 있다.
이를 공개 호스트 서비스(OHS, Open Host Service)라고 부르며, 대표적으로 검색 기능이 그러하다.

상위 컴포넌트와 하위 컴포넌트는 각각의 도메인 모델을 따르기에 서로의 도메인에 영향을 주지
않도록 보호해주는 완충 지대(ACL, Anti Corruption Layer)를 만들어야한다.
이는 컨텍스트간 모델 변환을 처리하기 떄문에 다른 바운디드 컨텍스트에 영향을 주지 않게 된다.

두 바운디드 컨텍스트가 같은 모델을 공유하는 경우도 존재할 수 있으며 이를 공유 커널이라고 부른다.
공유 커널은 중복을 줄여주지만, 임의로 모델을 변경하면 문제가 발생할 수 있다.
따라서 긴밀한 관계가 존재하지 않으면 공유 커널로 인해 오히려 개발이 지연될 수 있다.

서로 통합하지 않는 독립 방식 또한 존재한다.
이 경우 두 바운디드 컨텍스트 간의 통합은 수동으로 이루어지며 외부 연동 시스템이 그럴 수 있다.
하지만 규모가 커짐에 따라 두 바운디드 컨텍스트를 통합해주는 별도의 시스템이 필요할 수 있다.


