# 1장. 자바 8, 9, 10, 11: 무슨 일이 일어나고 있는가?

## 1.1 역사의 흐름은 무엇인가?

자바 역사를 통틀어 가장 큰 변화는 자바 8에서 일어났다. 

기존까지 대부분 자바 프로그램은 코어 중 하나만을 사용했다.
자바 1.0에서는 스레드와 락, 메모리 모델까지 지원했다. 자바 5에서는 스레드 풀,
병렬 실행 컬렉션 등의 강력한 도구가 도입되었다. 자바 7에서는 병렬 실행에 도움을 주는 포크/조인 프레임워크를 제공했지만 여전히 활용이 어려웠다.
자바 8에서는 병렬 실행을 새롭고 단순한 방식으로 접근할 수 있는 방법을 제공한다.

자바 8은 `간결한 코드, 멀티코어 프로세서의 쉬운 활용`이라는 두가지 요구사항을 기반으로 한다.

- 스트림 API
- 메서드에 코드를 전달하는 기법
- 인터페이스의 디폴트 메서드

자바 8에서 제공하는 스트림을 이용하면 멀티코어 CPU를 이용하는 것보다 비용이 비싼 synchonized 키워드를 사용하지 않아도 된다.
다른 관점에서 자바 8에 추가된 스트림 API 덕분에 코드를 전달하는 간결 기법과 인터페이스의
디폴트 메서드가 존재할 수 있음을 알 수 있게된다.

## 1.2 왜 아직도 자바는 변화하는가?

### 1.2.2 스트림 처리

스트림이란 한 번에 한 개씩 만들어지는 연속적인 데이터 항목들의 모임이다.

자바 8에서는 java.util.stream 패키지에 스트림 API가 추가되었다.
우선은 스트림 API가 조립라인처럼 `어떤 항목을 연속적으로 제공하는 어떤 기능`이라고 단순하게 생각할 수 있다.
스트림 API는 `파이프라인`을 만드는데 필요한 많은 메서드를 제공한다.

스트림 파이프라인을 이용해 입력 부분을 여러 CPU 코에어 쉽게 할당할 수도 있다.
스레드라는 복잡한 작업을 사용하지 않으면서도 `공짜 병렬성`을 얻을 수 있다.

### 1.2.3 동작 파라미터화로 메서드에 코드 전달하기

자바 8에 추가된 두 번째 프로그램 개념은 `코드 일부를 API로 전달하는 기능`이다.
자바 8에서는 메서드를 다른 메서드의 파라미터로 넘겨주는 기능을 제공한다.
이런 기능을 이론적으로 `동작 파라미터화(Behavior Parameterization)`라고 한다.
스트림 API는 `연산의 동작을 파라미터화할 수 있는 코드를 전달한다`는 사상에 기초하기 떄문에, 동작 파라미터화가 중요하다.

### 1.2.4 병렬성과 공유 가변 데이터

병렬성을 공짜로 얻는 대신 우리는 스트림 메서드로 전달하는 코드의 동작 방식을 조금 바꿔야한다.
스트림 메서드로 전달하는 코드는 `다른 코드와 동시에 실행하더라도 안전하게 실행`될 수 있어야 한다.
안전하게 실행할 수 있는 코드를 만들려면 `공유된 가변 데이터에 접근하지 않아야` 하며,
이런 함수를 `순수 함수`, 부작용 없는 함수, 상태없는 함수라고 부른다.

공유되지 않는 가변 데이터, 메서드, 함수 코드를 다른 메서드로 전달하는 두가지 기능은 함수형 프로그래밍 패러다임의 핵심 사항이다.
이에 반해 명령형 프로그래밍은 일련의 가변 상태로 프로그램을 정의한다.

## 1.3 자바 함수

함수(function)라는 용어는 메서드(method) 특히 정적 메서드와 같은 의미로 사용된다.
자바의 함수는 이에 더해 `수학적인 함수`처럼 사용되며 `부작용이 없는 함수`를 의미한다.

자바 8에서는 함수를 새로운 값의 형식으로 추가했다. `병렬 프로그래밍을 활용`할 수 있는 스트림과
연계될 수 있도록 함수를 만들었기 때문이다.

자바 프로그램에서 조작할 수 있는 값은 `기본값`과 `객체(객체의 참조)`가 존재한다.
객체 잠조는 `클래스의 인스턴스`를 가리킨다. 

그런데 함수가 왜 필요할까?

프로그래밍 언어의 핵심은 값을 바꾸는 것이다. 프로그램을 실행하는 동안 자유롭게 전달할 수 있는 값을
`일급(first-class) 시민`이라고 한다. 하지만 모든 구조체가 그렇지는 않으며, 이렇게 `전달할 수 없는 구조체는 이급 시민`이다.

자바 8에서는 함수를 값으로 취급할 수 있게 되었다. 이는 함수를 `일급 시민`으로 만들었다는 의미이다.
메서드, 클래스 등은 이급 시민에 해당한다. 하지만 런타임에 메서드를 전달할 수 있다면,
즉 일급 시민으로 만들면 프로그래밍에 유용하게 활용 가능하다.

### 1.3.1 메서드와 람다를 일급 시민으로

자바 8에서는 메서드를 값으로 취급할 수 있는 기능은 스트림과 같은 다른 자바 8 기능의 토대를 제공했다.

첫 번째로 메서드 참조라는 새로운 자바 8 기능이 있다.
자바 8의 `메서드 참조(Method reference)`는 메서드를 값으로 전달하는 기능으로 `::`로 표현한다.

자바 8에서는 메서드를 일급 시민으로 취급할 뿐만 아니라 람다 또는 익명함수를 포함하여
함수도 값으로 취급할 수 있다.

자바 8의 핵심은 `메서드를 전달할 수 있다`는 사실이다.

### 1.3.3 메서드 전달에서 람다로

메서드를 값으로 전달하는 것은 유용하지만, 한 두번 사용하는 메서드를 매번 정의하는 것은 귀찮은 일이다.
이런 경우 람다 표현식을 사용하면 된다. 하지만 람다가 몇 줄 이상으로 길어진다면
코드가 수행하는 일을 잘 설명할 수 있는 이름을 가진 메서드로 정의하고 메서드 참조를 활용하는 것이 좋다.

## 1.4 스트림

자바 어플리케이션에서는 컬렉션을 사용한다. 컬렉션에서는 반복 과정을 직접 처리해야했다.
이런 방식을 `외부 반복(extrernal iteration)`이라고 한다.
반면 스트림 API에서는 라이브러리 내부에서 모든 데이터가 처리되는 `내부 반복(internal iteration)`을 사용한다.

### 1.4.1 멀티스레딩은 어렵다

멀티스레딩 환경에서 각 스레드는 동시에 공유된 데이터에 접근하고 수정하기 때문에 원치 않는 방식으로 데이터가 바뀔 수 있다.

자바 8은 스트림 API로 컬렉션을 처리하면서 발생하는 모호함과 반복적인 코드문제
그리고 멀티코어 활용 어려움이라는 문제를 해결했다.

`컬렉션은 어떻게 데이터를 저장하고 접근`할지가 중점이고, `스트림은 데이터에 어떤 계산을 할 것`인지 묘사하는 것이 중점이다.

## 1.5 디폴트 메서드와 자바 모듈

패키지의 인터페이스를 바꿔야하는 상황에서 인터페이스를 구현하는 모든 클래스를 바꾸는 것은 어려운 일이다.
자바 8,9에서는 이 문제를 다른 방법으로 해결한다.

자바 9의 모듈 시스템은 모듈을 정의하는 문법을 제공하고 모듈을 정의할 수 있다.
또한 자바 8에서는 `인터페이스를 쉽게 바꿀 수 있도록 디폴트 메서드를 제공`한다.
디폴트 메서드는 특정 프로그램을 구현하는 데 도움을 주는 기능이라기보다는 미래에 프로그램이
쉽게 변화할 수 있는 환경을 제공하는 기능이라고 볼 수 있다.

앞서 말했듯 인터페이스에 새로운 메서드가 추가된다면 구현체 모두에 새로운 메서드를 추가해야한다.
자바 8에서는 `구현 클래스에 구현하지 않아도 되는 메서드를 인터페이스에 추가할 수 있는 기능`을 제공한다.
메서드 본문은 클래스 구현이 아니라 인터페이스의 일부로 포함된다.

## 1.6 함수형 프로그래밍에서 가져온 다른 유용한 아이디어

함수형 프로그래밍의 핵심적인 두가지 아이디어는 다음과 같다

- 메서드와 람다를 일급 시민으로 사용하는 것
- 가변 공유 상태가 없는 병렬 실행을 이용해서 효율적이고 안전하게 함수나 메서드를 호출할 수 있다는 것

추가적으로 null을 회피하는 Optional<T> 기법도 존재한다.
이는 값이 없는 상황을 어떻게 처리할지 명시적으로 구현하는 메서드들을 포함하고 있다.

## 결론

- 자바 8은 프로그램을 더 효과적이고 간결하게 구현할 수 있는 새로운 개념과 기능을 제공했다
  - 기존 자바 프로그램은 멀티코어 프로세서를 온전히 활용하기 어려웠다
- 함수는 일급 시민이다.
  - 메서드를 어떻게 함수형 값으로 넘겨주는지와 익명 함수(람다)를 어떻게 구현하는지는 중요하다
- 스트림과 컬렉션을 적절히 사용하면 병렬 처리와 함께 가독성 좋은 코드를 만들 수 있다
- 자바 9의 모듈 시스템과 디폴트 메소드를 통해 대규모 컴포넌트 기반 프로그래밍과 인터페이스 진화에 대응할 수 있게 되었다.

