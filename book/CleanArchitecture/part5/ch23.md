# 23장. 프레젠터와 험블객체

## 험블 객체 패턴

험블 객체 패턴은 디자인 패턴으로, 테스트하기 어려운 행위와 테스트하기 쉬운 행위를 단위
테스트 작성자가 분리하기 쉽게 하는 방법으로 고안되었다. 

행위들을 두 개의 모듈 또는 클래스로 나눈다

- 모듈 중 하나가 험블 객체
  - 가장 기본적인 본질외 테스트 하기 어려운 행위들은 모두 험블 객체로 이동
- 나머지 하나의 모듈은 테스트하기 쉬운 행위
험블 객체 패턴을 사용하면 두 부류의 행위를 분리하여 프레젠터와 뷰라는 서로 다른 클래스를 만들 수 있다.

## 프레젠터와 뷰

뷰는 험블 객체이고 테스트하기 어렵다. 반면 프레젠터는 테스트하기 쉬운 객체이다.
프레젠터의 역할은 어플리케이션으로부터 데이터를 받아와 화면에 표현할 수 있는 포맷으로 만드는 것이다.
뷰는 단순히 데이터를 화면으로 전달하는 일만 처리하게 만든다. 즉, 뷰는 데이터를 화면에 로드할 뿐,
추가적인 역할은 전혀 없다. 따라서 뷰는 보잘 것 없다(humble).

## 테스트와 아키텍쳐

행위를 테스트하기 쉬운 부분과 테스트하기 어려운 부분으로 분리하면 아키텍쳐 경계가 정의된다.

## 데이터베이스 게이트웨이(Database Gateway)

유스케이스 인터렉터와 데이터베이스 사이에는 데이터베이스 게이트웨이가 위치한다.
게이트웨이는 다형적 인터페이슬, 어플리케이션이 데이터베이스에 수행하는 CRUD 작업과 관련된 모든 메서드를 포함한다.

유스케이스 계층은 필요한 메서드를 제공하는 게이트웨이 인터페이스를 호출한다. 그리고 인터페이스의 구현체는
데이터베이스 계층에 위치한다. 여기서의 구현체는 험블 객체이다.

인터렉터는 험블객체가 아니기에 테스트하기 쉬운데, 게이트웨이는 스텁이나 테스트 mock 객체로 적당히 교체할 수 있기 때문이다.

## 데이터 매퍼(Data Mapper)

하이버네이트 같은 ORM은 어느 계층에 속할까?

객체 관계 매퍼(ORM)는 사실 존재하지 않는다. 객체는 내부의 private 변수와 public 메서드로 구성되어
실제 사용자는 public 메서드만 볼 수 있다. 따라서 사용자 관점에서 볼 때 객체는 오퍼레이션의 집합이다.

데이터 구조는 public 데이터 변수의 집합이다. ORM은 데이터 매퍼로 보는게 맞으며 관계형 데이터베이스 테이블로부터
가져온 데이터를 데이터구조에 맞게 담아주기 때문이다.

그렇기에 ORM은 데이터베이스 계층이며 실제로 게이트웨이 인터페이스와 데이터베이스 사이에 일종의 또다른 험블 객체 경계를 형성한다.

## 서비스 리스너

만약 어플리케이션이 다른 서비스와 반드시 통신해야 한다면? 또는 어플리케이션에서 어떤 서비스를 제공해야 한다면
우리는 경계를 생성하는 험블 객체 패턴을 발견할 수 있다.

어플리케이션은 데이터를 데이터 구조 형태로 로드한 후, 경계를 가로 질러 특정 모듈에 전달한다.
해당 모듈은 적절한 포맷으로 변경되어 외부 서비스로 전송한다.

반대로 외부로부터 데이터를 수신하는 서비스의 경우 서비스 리스너가 서비스 인터페이스로부터 데이터를 수신하고
어플리케이션에서 사용할 수 있는 데이터 구조로 변경한다. 이후 이 데이터는 서비스 경계를 가로질러 내부로 전달된다.

## 결론

- 경계를 넘나드는 통신은 거의 모두 간단한 데이터 구조를 수반할 때가 많고, 그 경계는 테스트하기 어려운 무언가와
테스트하기 쉬운 무언가로 분리된다. 
- 이때 험블 객체 패턴을 사용하면 전체 시스템의 테스트 용이성을 크게 높일 수 있다.
