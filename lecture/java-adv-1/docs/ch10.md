# 스레드 풀과 Executor 프레임워크

## 스레드를 직접 생성해서 사용할 때의 문제점

- 스레드 생성 비용으로 인한 성능문제
  - 단순 객체를 생성하는 것과 비교할 수 없을 정도의 큰 작업
  - 가벼운 작업의 경우 실행 시간 보다 생성 시간이 더 길어 질 수 있음
- 스레드 관리 문제
  - 서버의 CPU 및 메모리 자원이 한정적이기에 스레드는 무한하게 만들 수 없음
  - 어플리케이션 종료 시에도 모든 스레드를 종료시켜야하기에 관리가 필요함
- Runnable 인터페이스의 불편함
  - 반환 값이 없음
  - 예외 처리

## Executor 프레임워크

멀티 스레딩 및 병렬 처리를 사용하기 편하게 사용하도록 돕는 프레임워크

### 주요 구성 요소

- Executor 인터페이스
  - 가장 단순한 작업 실행 인터페이스
  - runnable 객체를 받아 실행하는 인터페이스
- ExecutorService 인터페이스
  - Executor 인터페이스를 상속받아 작업 제출과 제어 기능을 추가로 제공
    - 주요 메서드는 submit(), close()
  - Executor 프레임워크를 사용할 때 대부분 해당 인터페이스를 사용

## Future

### Runnable과 Callable

```java
public interface Runnable {
    void run();
}

public interface Callable<V> {
    V call() throws Exception;
}
```

- Runnable은 void 반환타입이고 체크 예외를 던질 수 없음
- Callable은 반환타입이 V이고 체크 예외를 던질 수 있음
  - ExecutorService의 submit() 메서드에 Callable을 제출하면 Future 객체를 반환
  - Future 객체를 통해 작업의 상태를 확인하거나 결과를 가져올 수 있음

### Future - 정리

- 미래의 계산 결과를 나타내며, 계산이 완료되었는지 확인하고 완료될 때까지 대기하는 기능이 존재
- 주요 메서드
  - cancel
    - 아직 완료되지 않은 작업을 취소
    - 매개변수를 통해 실행중인 작업은 취소하지 않거나 인터럽트를 통해 취소할지 정할 수 있음
  - isCancelled
    - 작업이 취소되었는지 확인
  - isDone
    - 작업이 완료되었는지 확인
  - state
    - Future의 상태를 반환(자바 19부터 지원)
      - RUNNING
      - SUCCESS
      - FAILED
      - CANCELLED
  - get
    - 작업의 결과를 기다리고 완료되면 결과를 받음
    - 파라미터를 통해 일정 시간 동안 결과를 받지 못하면 예외를 발
    - 예외 발생
      - InterruptedException
        - 대기 중에 인터럽트 되는 경우
      - ExecutionException
        - 작업 중 예외가 발생한 경
      - TimeoutException
        - 시간이 초과된 경우